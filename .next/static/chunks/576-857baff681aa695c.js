"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[576],{6263:(e,t,o)=>{o.d(t,{DY:()=>d,HW:()=>h,LL:()=>c,Lx:()=>u,NU:()=>n,kg:()=>g,y4:()=>f});var r=o(5594),a=o(376),s=o(3327);let n={projectId:"686cee83002d3d0a6c2a",endpoint:"https://syd.cloud.appwrite.io/v1",databaseId:"686f57ef0030a8f74e85",collections:{users:"686f581c000af0ad4c69",audits:"686f5853002a3718e56e",contacts:"686f5aaf00140d424518",sessions:"sessions_collection_id"},bucketId:"auditspro_documents",sdkVersion:"18.1.1",serverVersion:"1.7.x",platform:{name:"AuditsPro Web App",hostname:window.location.hostname}},i=new s.Kj;try{i.setEndpoint(n.endpoint).setProject(n.projectId),console.log("\uD83D\uDE80 Appwrite Client initialized for: ".concat(n.platform.hostname))}catch(e){console.error("❌ Failed to initialize Appwrite client:",e)}let l=new s.gD(i),c=new s.Lv(i);new s.wc(i),new s.P9(i);let u=async(e,t)=>{try{console.log("\uD83D\uDD10 Authenticating user:",e);let o=await l.createEmailPasswordSession(e,t);return console.log("✅ Authentication successful:",{sessionId:o.$id,userId:o.userId,provider:o.provider,expire:o.expire}),o}catch(e){var o;if(console.error("❌ Authentication failed:",e),401===e.code)throw Error("Invalid email or password. Please check your credentials and try again.");if(429===e.code)throw Error("Too many login attempts. Please wait a few minutes before trying again.");if(400===e.code)throw Error("Invalid email format. Please enter a valid email address.");else if(null==(o=e.message)?void 0:o.includes("network"))throw Error("Network error. Please check your internet connection and try again.");else throw Error(e.message||"Login failed. Please try again or contact support.")}},d=async(e,t,o)=>{try{console.log("\uD83D\uDCDD Creating user account:",{email:e,name:o});let r=await l.create("unique()",e,t,o);return console.log("✅ User account created:",{userId:r.$id,email:r.email,name:r.name,status:r.status}),r}catch(e){var r,a,s;if(console.error("❌ Registration failed:",e),409===e.code)throw Error("An account with this email address already exists. Please try signing in instead.");if(400===e.code){if(null==(a=e.message)?void 0:a.includes("password"))throw Error("Password must be at least 8 characters long and contain a mix of letters and numbers.");if(null==(s=e.message)?void 0:s.includes("email"))throw Error("Please enter a valid email address.");throw Error("Please check your information and try again.")}if(null==(r=e.message)?void 0:r.includes("network"))throw Error("Network error. Please check your internet connection and try again.");else throw Error(e.message||"Registration failed. Please try again or contact support.")}},g=async e=>{try{console.log("\uD83D\uDCBE Creating user document:",e);let t=(0,a._)((0,r._)({},e),{preferences:(0,r._)({notifications:!0,newsletter:!1,theme:"system",language:"en-AU"},e.preferences),subscription:(0,r._)({plan:"free",status:"active"},e.subscription),metadata:(0,r._)({lastLoginAt:new Date().toISOString(),loginCount:1},e.metadata),$createdAt:new Date().toISOString(),$updatedAt:new Date().toISOString()}),o=await c.createDocument(n.databaseId,n.collections.users,"unique()",t);return console.log("✅ User document created:",o.$id),o}catch(e){throw console.error("❌ Failed to create user document:",e),console.warn("⚠️ User authenticated but profile creation failed. Profile can be created later."),e}},h=async()=>{try{console.log("\uD83D\uDC64 Getting current user session...");let e=await l.get();return console.log("✅ Current user session:",{userId:e.$id,email:e.email,name:e.name,status:e.status,emailVerification:e.emailVerification}),e}catch(e){return console.log("ℹ️ No active user session"),null}},f=async()=>{try{console.log("\uD83D\uDEAA Logging out user..."),await l.deleteSession("current"),console.log("✅ User logged out successfully"),localStorage.removeItem("user"),sessionStorage.clear()}catch(e){console.error("❌ Logout error:",e),console.warn("⚠️ Logout may have failed, but local session cleared")}};console.log("\uD83D\uDE80 AuditsPro Appwrite SDK initialized successfully!"),console.log("\uD83D\uDCCA Configuration:",{projectId:n.projectId,endpoint:n.endpoint,databaseId:n.databaseId,collections:Object.keys(n.collections).length,sdkVersion:n.sdkVersion,serverVersion:n.serverVersion}),console.log("✅ Ready for authentication and database operations")},9576:(e,t,o)=>{o.d(t,{As:()=>l,AuthProvider:()=>c});var r=o(5155),a=o(2115),s=o(5695),n=o(6263);let i=(0,a.createContext)(null),l=()=>{let e=(0,a.useContext)(i);if(!e)throw Error("useAuth must be used within an AuthProvider. Make sure to wrap your app with <AuthProvider>.");return e},c=e=>{let{children:t}=e,[o,l]=(0,a.useState)(null),[c,u]=(0,a.useState)(!0),[d,g]=(0,a.useState)(null),h=(0,s.useRouter)(),f=(0,s.usePathname)(),m=!!o,w=(0,a.useCallback)(()=>{g(null)},[]),p=(0,a.useCallback)(()=>{l(null),g(null)},[]),y=(0,a.useCallback)(e=>{g(e),setTimeout(()=>g(null),5e3)},[]),v=(0,a.useCallback)(async()=>{try{console.log("\uD83D\uDD0D Checking authentication status...");let e=await (0,n.HW)();if(e)return console.log("✅ User is authenticated:",e.email),l(e),g(null),!0;return console.log("❌ No authenticated user found"),l(null),!1}catch(e){return console.error("❌ Auth check failed:",e),l(null),y("Session validation failed"),!1}},[y]),b=(0,a.useCallback)(async()=>{try{console.log("\uD83D\uDD04 Refreshing user data...");let e=await (0,n.HW)();e?(l(e),g(null),console.log("✅ User data refreshed")):(p(),console.log("❌ User session expired"))}catch(e){console.error("❌ Failed to refresh user:",e),y("Failed to refresh user data")}},[p,y]),k=(0,a.useCallback)(async()=>{try{console.log("\uD83D\uDEAA Logging out user..."),u(!0),p(),await (0,n.y4)(),console.log("✅ User logged out successfully"),h.push("/login")}catch(e){console.error("❌ Logout error:",e),p(),h.push("/login")}finally{u(!1)}},[p,h]);return(0,a.useEffect)(()=>{let e=!0;return(async()=>{try{console.log("\uD83D\uDE80 Initializing authentication...");let t=["/login","/signup","/forgot-password","/reset-password"].some(e=>f===e);if(t){console.log("\uD83D\uDCCD On public route, skipping auth check"),u(!1);return}let o=await v();if(!e)return;o||t||(console.log("\uD83D\uDD04 Redirecting to login..."),h.push("/login"))}catch(t){console.error("❌ Auth initialization failed:",t),e&&y("Authentication initialization failed")}finally{e&&u(!1)}})(),()=>{e=!1}},[f,v,h,y]),(0,a.useEffect)(()=>{if(!m)return;let e=setInterval(async()=>{try{await b()}catch(e){console.error("❌ Automatic refresh failed:",e)}},3e5);return()=>clearInterval(e)},[m,b]),(0,a.useEffect)(()=>{let e=()=>{"visible"===document.visibilityState&&m&&(console.log("\uD83D\uDC40 Page became visible, refreshing auth..."),b())};return document.addEventListener("visibilitychange",e),()=>{document.removeEventListener("visibilitychange",e)}},[m,b]),(0,r.jsx)(i.Provider,{value:{user:o,isLoading:c,isAuthenticated:m,checkAuth:v,logout:k,refreshUser:b,clearAuth:p,error:d,clearError:w},children:t})};console.log("\uD83D\uDD10 Authentication Context initialized successfully!")}}]);